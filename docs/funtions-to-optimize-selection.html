<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Funtions to optimize selection | Bringing genomics to the field: an integrative approach to forest restoration</title>
<meta name="author" content="Anoob Prakash">
<meta name="description" content="Select regions to select sources Based on the idea of Regional admixture provenancing (citation), seed sources were selected regionally for each restoration site. Three groups of source...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="Funtions to optimize selection | Bringing genomics to the field: an integrative approach to forest restoration">
<meta property="og:type" content="book">
<meta property="og:description" content="Select regions to select sources Based on the idea of Regional admixture provenancing (citation), seed sources were selected regionally for each restoration site. Three groups of source...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Funtions to optimize selection | Bringing genomics to the field: an integrative approach to forest restoration">
<meta name="twitter:description" content="Select regions to select sources Based on the idea of Regional admixture provenancing (citation), seed sources were selected regionally for each restoration site. Three groups of source...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Bringing genomics to the field: an integrative approach to forest restoration</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li class="book-part">Genomic selection of sources</li>
<li><a class="" href="setting-up.html">Setting up</a></li>
<li><a class="active" href="funtions-to-optimize-selection.html">Funtions to optimize selection</a></li>
<li><a class="" href="factors-affecting-source-selection.html">Factors affecting source selection</a></li>
<li><a class="" href="save-data-for-downstream-analysis.html">Save data for downstream analysis</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/anoobvinu07/Genomic_assisted_selection">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="funtions-to-optimize-selection" class="section level1 unnumbered">
<h1>Funtions to optimize selection<a class="anchor" aria-label="anchor" href="#funtions-to-optimize-selection"><i class="fas fa-link"></i></a>
</h1>
<div id="select-regions-to-select-sources" class="section level2 unnumbered">
<h2>Select regions to select sources<a class="anchor" aria-label="anchor" href="#select-regions-to-select-sources"><i class="fas fa-link"></i></a>
</h2>
<p>Based on the idea of <strong><em>Regional admixture provenancing</em></strong> (citation), seed sources were selected regionally for each restoration site. Three groups of source populations were subsetted for the three planting sites, removing XVC and HR because of their northern ancestry. More info on the regional ancestry detailed in (citation).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sources considered for the Maryland restoration site </span></span>
<span><span class="va">TAB_pop_maryland</span> <span class="op">&lt;-</span> <span class="va">TAB_pop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">TAB_pop</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">info_pops</span><span class="op">$</span><span class="va">Region</span><span class="op">==</span><span class="st">"E"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">info_pops</span><span class="op">$</span><span class="va">State</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NC"</span>,<span class="st">"TN"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"XCV"</span>,<span class="st">"HR"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Sources considered for the West Virginia restoration site</span></span>
<span><span class="va">TAB_pop_westvirginia</span> <span class="op">&lt;-</span> <span class="va">TAB_pop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">TAB_pop</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">info_pops</span><span class="op">$</span><span class="va">Region</span><span class="op">==</span><span class="st">"E"</span> <span class="op">&amp;</span> <span class="va">info_pops</span><span class="op">$</span><span class="va">State</span><span class="op">==</span><span class="st">"WV"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"XCV"</span>,<span class="st">"HR"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Sources considered for the Virginia restoration site</span></span>
<span><span class="va">TAB_pop_virginia</span> <span class="op">&lt;-</span> <span class="va">TAB_pop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">TAB_pop</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">info_pops</span><span class="op">$</span><span class="va">Region</span><span class="op">==</span><span class="st">"E"</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">info_pops</span><span class="op">$</span><span class="va">State</span><span class="op">==</span><span class="st">"WV"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"XCV"</span><span class="op">)</span> <span class="op">|</span> <span class="va">info_pops</span><span class="op">$</span><span class="va">Site</span><span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GMF"</span>,<span class="st">"CR"</span>,<span class="st">"DG"</span>,<span class="st">"RP"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="co"># remove HR and CV for the paper</span></span></code></pre></div>
</div>
<div id="optimizing-genetic-diversity" class="section level2 unnumbered">
<h2>Optimizing genetic diversity<a class="anchor" aria-label="anchor" href="#optimizing-genetic-diversity"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to estimate allelic richness after rarefaction</span></span>
<span><span class="va">rarefy_AR</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">g</span>, <span class="va">bootstraping</span><span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Nijg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">Njg</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">*</span><span class="fl">2</span></span>
<span>  <span class="va">nbind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">Nij</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">boot</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">bootstraping</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nbind</span>, <span class="va">g</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">g</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">Nij</span><span class="op">[[</span><span class="va">boot</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>,<span class="va">inds</span><span class="op">]</span><span class="op">*</span><span class="fl">2</span><span class="op">}</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">g</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">Nij</span><span class="op">[[</span><span class="va">boot</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="va">inds</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">g</span><span class="op">*</span><span class="fl">2</span><span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">Nijg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">Nij</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">Qijg</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Njg</span><span class="op">-</span><span class="va">Nijg</span><span class="op">)</span><span class="op">/</span><span class="va">Njg</span></span>
<span>  <span class="va">Pijg</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">Qijg</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">Pijg</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="estimate-the-genetic-load" class="section level2 unnumbered">
<h2>Estimate the genetic load<a class="anchor" aria-label="anchor" href="#estimate-the-genetic-load"><i class="fas fa-link"></i></a>
</h2>
<p>The following function is used to estiamte the ratio of nonsynonymous/synonymous mutation based on the annotation from <a href="https://pcingola.github.io/SnpEff/">SnpEff v5.1</a> <em>(Cingolani et al., 2012)</em>, which was used to annotate genetic variants to functional class based on Norway spruce genome annotation. The functional categories <em>viz.</em> <code>missense variant, splice acceptor variant, splice donor variant, splice region variant, start lost, stop gained, stop lost</code> were used to designate as non-synonymous mutation in our calculation for genetic load.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genetic_load</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">category</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">nonsyn_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">category</span><span class="op">==</span><span class="st">"missense_variant"</span> <span class="op">|</span> <span class="va">category</span><span class="op">==</span><span class="st">"splice_acceptor_variant"</span> <span class="op">|</span> <span class="va">category</span><span class="op">==</span><span class="st">"splice_donor_variant"</span> <span class="op">|</span> <span class="va">category</span><span class="op">==</span><span class="st">"splice_region_variant"</span> <span class="op">|</span> <span class="va">category</span><span class="op">==</span><span class="st">"start_lost"</span> <span class="op">|</span> <span class="va">category</span><span class="op">==</span><span class="st">"stop_gained"</span> <span class="op">|</span> <span class="va">category</span><span class="op">==</span><span class="st">"stop_lost"</span><span class="op">)</span></span>
<span>  <span class="va">freq_nonsyn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">nonsyn_sites</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">freq_syn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="op">-</span><span class="va">nonsyn_sites</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">ratio_2</span> <span class="op">&lt;-</span> <span class="va">freq_nonsyn</span><span class="op">/</span><span class="va">freq_syn</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ratio_2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="combined-function-to-optimize-source-combinations" class="section level2 unnumbered">
<h2>Combined function to optimize source combinations<a class="anchor" aria-label="anchor" href="#combined-function-to-optimize-source-combinations"><i class="fas fa-link"></i></a>
</h2>
<p>This function combines the rarefy_AR and genetic_load function to estimate expected heterozygosity (Hexp), allelic richness and genetic load in all combinations of <strong><em>P</em></strong> populations. The <strong><em>P</em></strong> depends on the number of sources one decides to select for their restoration site.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to estimate Hexp, Allelic Richness and Genetic Load in all combination of P populations</span></span>
<span><span class="va">optimize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">P</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Total diversity and load with all the populations</span></span>
<span>  <span class="va">TAB_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>,<span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">freq_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">TAB_tot</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">hexp_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">freq_tot</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq_tot</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="co">#all_rich_tot &lt;- mean(rarefy_AR(TAB_tot, ncol(TAB_tot)), na.rm = T)</span></span>
<span>  <span class="va">genetic_load_tot</span> <span class="op">&lt;-</span> <span class="fu">genetic_load</span><span class="op">(</span><span class="va">TAB_tot</span>, <span class="va">category</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Genetic diversity and load with only a subset of P populations</span></span>
<span>  <span class="va">hexp_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="va">genetic_load_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/combn.html">combn</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="va">P</span>, simplify <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">comb</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">TAB_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">data</span><span class="op">[</span><span class="va">comb</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">freq_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">TAB_sub</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">hexp_sub</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">freq_sub</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq_sub</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">genetic_load_sub</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">genetic_load</span><span class="op">(</span><span class="va">TAB_sub</span>, <span class="va">category</span><span class="op">)</span></span>
<span>    <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">comb</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">TAB_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">hexp_sub</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Hexp <span class="op">=</span> <span class="va">hexp_sub</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, GenLoad <span class="op">=</span> <span class="va">genetic_load_sub</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#AllRich = all_rich_sub[[x]], </span></span>
<span>  <span class="va">TAB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Hexp <span class="op">=</span> <span class="va">hexp_tot</span>, GenLoad <span class="op">=</span> <span class="va">genetic_load_tot</span><span class="op">)</span>, <span class="va">TAB_sub</span><span class="op">)</span> <span class="co">#AllRich = all_rich_tot, </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">TAB</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">names</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">TAB</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="apply-the-function-to-get-optimal-source-combinations" class="section level2 unnumbered">
<h2>Apply the function to get optimal source combinations<a class="anchor" aria-label="anchor" href="#apply-the-function-to-get-optimal-source-combinations"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Optimization sources for site in Maryland</span></span>
<span><span class="va">res_maryland</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">TAB_pop_maryland</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">res_maryland</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">res_maryland</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">res_maryland</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">res_maryland</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">res_maryland</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Optimization sources for site in West Virginia</span></span>
<span><span class="va">res_westvirginia_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">TAB_pop_westvirginia</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">res_westvirginia_4</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">res_westvirginia_4</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optimization sources for site in Virginia</span></span>
<span><span class="va">res_virginia_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span><span class="op">(</span><span class="va">TAB_pop_virginia</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">res_virginia_4</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">res_virginia_4</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="setting-up.html">Setting up</a></div>
<div class="next"><a href="factors-affecting-source-selection.html">Factors affecting source selection</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#funtions-to-optimize-selection">Funtions to optimize selection</a></li>
<li><a class="nav-link" href="#select-regions-to-select-sources">Select regions to select sources</a></li>
<li><a class="nav-link" href="#optimizing-genetic-diversity">Optimizing genetic diversity</a></li>
<li><a class="nav-link" href="#estimate-the-genetic-load">Estimate the genetic load</a></li>
<li><a class="nav-link" href="#combined-function-to-optimize-source-combinations">Combined function to optimize source combinations</a></li>
<li><a class="nav-link" href="#apply-the-function-to-get-optimal-source-combinations">Apply the function to get optimal source combinations</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/anoobvinu07/Genomic_assisted_selection/blob/master/1.2-function_to_estimate_gd-gl.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/anoobvinu07/Genomic_assisted_selection/edit/master/1.2-function_to_estimate_gd-gl.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Bringing genomics to the field: an integrative approach to forest restoration</strong>" was written by Anoob Prakash. It was last built on 2023-11-21.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
